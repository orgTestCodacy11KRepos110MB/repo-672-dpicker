!function(e,t){"function"==typeof define&&define.amd?define("DPicker.modules.time",["DPicker","moment"],t):"object"==typeof module&&module.exports?module.exports=t(require("dpicker"),require("moment")):e.DPicker.modules.time=t(e.DPicker,e.moment)}(this,function(e,t){"use strict";if(!e)throw new ReferenceError("DPicker is required for this extension to work");var i=new Array(60).fill(0).map(function(e,t){return t}),n=new Array(24).fill(0).map(function(e,t){return t}),r=new Array(12).fill(0).map(function(e,t){return 0===t?12:t});r.push(r.shift());var a=e.injector(function(t,a,o){if(a.time){var u=a.model.hours();a.meridiem&&(u=u>12?u-12:u,u=0===u?12:u);var s=a.model.minutes(),m=a.meridiem?r:n,d=i.filter(function(e){return e%a.step===0});[a.min,a.max].map(function(e,t){if(a.model.isSame(e,"day")){var i=+a.meridiem?e.format("h"):e.hours();if(m=m.filter(function(e){return 0===t?e>=i:e<=i}),a.model.isSame(e,"hours")){var n=e.minutes();d=d.filter(function(e){return 0===t?e>=n:e<=i})}}});var h=[e.h("select",{onchange:t.hoursChange,name:"dpicker-hours","aria-label":"Hours"},m.map(function(t,i){return e.h("option",{value:t,selected:t===u,key:t},t<10?"0"+t:t)})),e.h("select",{onchange:t.minutesChange,name:"dpicker-minutes","aria-label":"Minutes"},d.map(function(t){return e.h("option",{value:t,selected:t===s,key:t},t<10?"0"+t:""+t)}))];if(a.meridiem){var l=a.model.format("A");h.push(e.h("select",{onchange:t.meridiemChange,name:"dpicker-meridiem"},["AM","PM"].map(function(t){return e.h("option",{value:t,selected:l===t},t)})))}return e.h("span.dpicker-time",h)}}),o={hoursChange:function(e){this._data.empty=!1;var t=parseInt(e.target.options[e.target.selectedIndex].value,10);this._data.meridiem&&("PM"===this._data.model.format("A")?t=12===t?12:t+12:12===t&&(t=0)),this._data.model.hours(t),this.onChange()},minutesChange:function(e){this._data.empty=!1,this._data.model.minutes(e.target.options[e.target.selectedIndex].value),this.onChange()},meridiemChange:function(e){this._data.empty=!1;var t=e.target.options[e.target.selectedIndex].value,i=this._data.model.hours();i="AM"===t?12===i?0:i-12:12===i?12:i+12,this._data.model.hours(i),this.onChange()},inputChange:function(){this._minutesStep()}},u=e.modules.time={events:o,render:[a],properties:{time:{"default":!1,attribute:function(e){var t=e.find(function(e){return"type"===e.name});return!!t&&"datetime"===t.value},getset:!0},meridiem:{"default":!1,attribute:"meridiem",getset:!0},step:{"default":1,attribute:function(e){var t=e.find(function(e){return"step"===e.name});return t?parseInt(t.value,10):1},getset:!0}},calls:{_initialize:function(e){this._minutesStep()},_modelSetter:function(e){this._minutesStep(),this._projector.scheduleRender()}}};return e.prototype._minutesStep=function(){var e=this;if(this._data.time&&!(this._data.step<=1)){var t=i.filter(function(t){return t%e._data.step===0}),n=this._data.model.minutes();if(n>t[t.length-1])return this._data.model.minutes(0),void this._data.model.add(1,"hours");t[t.length]=60,n=t.reduce(function(e,t){return Math.abs(t-n)<Math.abs(e-n)?t:e}),t.length--,this._data.model.minutes(n)}},u});