!function(e,t){"function"==typeof define&&define.amd?define("DPicker.modules.time",["DPicker","moment"],t):"object"==typeof module&&module.exports?module.exports=t(require("dpicker"),require("moment")):e.DPicker.modules.time=t(e.DPicker,e.moment)}(this,function(e,t){"use strict";function i(e){var t=e.meridiem?a:r,i=n.filter(function(t){return t%e.step===0});return[e.min,e.max].map(function(n,r){if(e.model.isSame(n,"day")){var a=+e.meridiem?n.format("h"):n.hours();if(t=t.filter(function(e){return 0===r?e>=a:e<=a}),e.model.isSame(n,"hours")){var u=n.minutes();i=i.filter(function(e){return 0===r?e>=u:e<=a})}}}),{hours:t,minutes:i}}if(!e)throw new ReferenceError("DPicker is required for this extension to work");var n=new Array(60).fill(0).map(function(e,t){return t}),r=new Array(24).fill(0).map(function(e,t){return t}),a=new Array(12).fill(0).map(function(e,t){return 0===t?12:t});a.push(a.shift());var u=e.injector(function(t,n,r){if(n.time){var a=n.model.hours();n.meridiem&&(a=a>12?a-12:a,a=0===a?12:a);var u=n.model.minutes(),o=i(n),s=o.hours,m=o.minutes,d=[e.h("select",{onchange:t.hoursChange,name:"dpicker-hours","aria-label":"Hours"},s.map(function(t,i){return e.h("option",{value:t,selected:t===a,key:t},t<10?"0"+t:t)})),e.h("select",{onchange:t.minutesChange,name:"dpicker-minutes","aria-label":"Minutes"},m.map(function(t){return e.h("option",{value:t,selected:t===u,key:t},t<10?"0"+t:""+t)}))];if(n.meridiem){var h=n.model.format("A");d.push(e.h("select",{onchange:t.meridiemChange,name:"dpicker-meridiem"},["AM","PM"].map(function(t){return e.h("option",{value:t,selected:h===t},t)})))}return e.h("span.dpicker-time",d)}}),o={hoursChange:function(e){this._data.empty=!1;var t=parseInt(e.target.options[e.target.selectedIndex].value,10);this._data.meridiem&&("PM"===this._data.model.format("A")?t=12===t?12:t+12:12===t&&(t=0)),this._data.model.hours(t),this.onChange()},minutesChange:function(e){this._data.empty=!1,this._data.model.minutes(e.target.options[e.target.selectedIndex].value),this.onChange()},meridiemChange:function(e){this._data.empty=!1;var t=e.target.options[e.target.selectedIndex].value,i=this._data.model.hours();i="AM"===t?12===i?0:i-12:12===i?12:i+12,this._data.model.hours(i),this.onChange()},inputChange:function(){this._minutesStep()}},s=e.modules.time={events:o,render:[u],properties:{time:{"default":!1,attribute:function(e){var t=e.find(function(e){return"type"===e.name});return!!t&&"datetime"===t.value},getset:!0},meridiem:{"default":!1,attribute:"meridiem",getset:!0},step:{"default":1,attribute:function(e){var t=e.find(function(e){return"step"===e.name});return t?parseInt(t.value,10):1},getset:!0}},calls:{_initialize:function(e){this._minutesStep()},_modelSetter:function(e){this._minutesStep(),this._projector.scheduleRender()}}};return e.prototype._minutesStep=function(){if(this._data.time&&!(this._data.step<=1)){var e=i(this._data),t=(e.hours,e.minutes),n=this._data.model.minutes();if(0===t.length){this._data.min.minutes(0),this._data.min.add(1,"hours");var r=i(this._data);r.hours,r.minutes}if(n>t[t.length-1])return this._data.model.minutes(0),void this._data.model.add(1,"hours");t[t.length]=60,n=t.reduce(function(e,t){return Math.abs(t-n)<Math.abs(e-n)?t:e}),t.length--,this._data.model.minutes(n)}},s});