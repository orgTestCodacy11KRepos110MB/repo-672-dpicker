!function(t,e){"function"==typeof define&&define.amd?define("DPicker",["moment"],e):"object"==typeof module&&module.exports?module.exports=e(require("moment")):t.DPicker=e(t.moment)}(this,function(t){"use strict";function e(){}function n(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(t){return(t^16*Math.random()>>t/4).toString(16)})}function a(t,e){for(;t&&t!==document;){if(t.getAttribute("id")===e)return!0;t=t.parentNode}return!1}function i(t){return/^aria/.test(t)}function r(t,e,n){i(e)?t.setAttribute(e,n):t[e]=n}function o(t,e,n){return i()?t.getAttribute(e):t[e]}function d(t,e){return i()?t.removeAttribute(e):(t[e]=void 0,!0)}function s(e){var a=void 0!==arguments[1]?arguments[1]:{},i=this;if(!(this instanceof s))return new s(e,a);if(this._container=n(),s.hasOwnProperty("properties")||(s.prototype.properties={format:{default:"DD/MM/YYYY",attribute:"format",getset:!0},model:{default:t(),moment:!0,attribute:"value"},display:{default:!1,getset:!0},hideOnDayClick:{default:!0},hideOnEnter:{default:!0},min:{default:t("1986-01-01"),moment:!0,attribute:"min",getset:!0},max:{default:t().add(1,"year").month(11),moment:!0,attribute:"max",getset:!0},months:{default:t.months(),getset:!0},days:{default:t.weekdaysShort(),getset:!0},inputName:{default:"dpicker-input",attribute:"name"},inputId:{default:n(),attribute:"id"},empty:{default:!1},valid:{default:!0},order:{default:["months","years","time","days"]},concatHoursAndMinutes:{default:!1},siblingMonthDayClick:{default:!1}}),this.onChange=a.onChange,this._data={},this._loadModules(),this._initData(a),document.addEventListener("click",this._events.hide),"undefined"==typeof e)throw new ReferenceError("Can not initialize DPicker without a container");if(void 0!==e.length&&e[0]&&(e=e[0]),"INPUT"===e.tagName){if(!e.parentNode)throw new ReferenceError("Can not initialize DPicker on an input without parent node");this._parseInputAttributes([].slice.call(e.attributes));var r=e.parentNode;e.parentNode.removeChild(e),e=r,e.classList.add("dpicker")}this._initialize(),this.mount(e,this.renderContainer(this._events,this._data,[this.renderInput(this._events,this._data),this.render(this._events,this._data,this.getRenderChild())])),e.id=this._container,e.addEventListener("keydown",this._events.keyDown);var o=e.querySelector("input");return o.addEventListener("blur",this._events.inputBlur),document.addEventListener("touchend",function(t){i._events.inputBlur(t)}),this.rootElement=e,this}return s.prototype.toggle=function(){var t=this.rootElement.querySelector(".dpicker-container");this.display===!0?(t.classList.remove("dpicker-invisible"),t.classList.add("dpicker-visible")):(t.classList.add("dpicker-invisible"),t.classList.remove("dpicker-visible"))},s.prototype._initialize=function(){this.isValid(this._data.model)},s.prototype.mount=function(t,e){t.appendChild(e)},s.prototype.replace=function(t,e){var n=this.rootElement.querySelector(t);n.parentNode.replaceChild(e,n)},s.prototype.merge=function(t,e){for(var n=this.rootElement.querySelector(t),a=0;a<e.attributes.length;a++){var i=e.attributes[a],s=i.name,u=i.value;o(n,s)!==u&&r(n,s,u)}for(var l=0;l<n.attributes.length;l++){var c=n.attributes[l],h=c.name;c.value;void 0===o(e,h)&&d(n,h)}e.value!==n.value&&(n.value=e.value)},s.prototype.redraw=function(t){t||(t=["input","container"]);for(var e=0;e<t.length;e++)switch(t[e]){case"input":this.merge("input",this.renderInput(this._events,this._data));break;case"days":this.replace("table",this.renderDays(this._events,this._data));break;case"container":this.replace(".dpicker-container",this.render(this._events,this._data,this.getRenderChild()))}},s.prototype.getRenderChild=function(){var t={years:this.renderYears(this._events,this._data),months:this.renderMonths(this._events,this._data)};for(var e in this._modulesRender)for(var n in this._modulesRender[e])t[n]=this._modulesRender[e][n](this._events,this._data);return t.days=this.renderDays(this._events,this._data),this._data.order.filter(function(e){return t[e]}).map(function(e){return t[e]})},s.prototype._initData=function(t){var e,n=this,a=function(e){var a=n.properties[e];return!a.getset||e in s.prototype||Object.defineProperty(s.prototype,e,{get:function(){return this._data[e]},set:function(t){this._data[e]=t,"display"===e?this.toggle():this.redraw()}}),n._data[e]=a.default,void 0===t[e]?0:"model"!==e||t[e]?void(n._data[e]=t[e]):(n._data.empty=!0,1)};t:for(var i in this.properties)switch(e=a(i)){case 0:continue t;case 1:continue t}},s.prototype._parseInputAttributes=function(e){var n,a=this,i=function(n){var i=a.properties[n];if(void 0===i.attribute)return 0;if("function"==typeof i.attribute)return a._data[n]=i.attribute(e),1;var r=e.filter(function(t){return t.name===i.attribute})[0];if(!r)return 2;var o=r.value;return o?i.moment===!0&&(o=t(r.value,a._data.format,!0),o.isValid()===!1)?5:void(a._data[n]=o):"model"===n?(a._data.empty=!0,3):4};t:for(var r in this.properties)switch(n=i(r)){case 0:continue t;case 1:continue t;case 2:continue t;case 3:continue t;case 4:continue t;case 5:continue t}},s.prototype._loadModules=function(){var t=this;this._events=this._loadEvents(),this._modulesRender={};for(var e in s.modules){var n=s.modules[e],a=this,i=function(e){return a._events[e]?(a._events[e+"-internal"]||(a._events[e+"-internal"]=[a._events[e]],a._events[e]=function(n){t._events[e+"-internal"].map(function(e){return e.bind(t)(n)})}),void a._events[e+"-internal"].unshift(n.events[e])):(a._events[e]=n.events[e].bind(a),0)},r=void 0;t:for(var o in n.events)switch(r=i(o)){case 0:continue t}var d=this,u=function(e){return s.prototype.hasOwnProperty(e)&&"function"==typeof n.calls[e]?(d[e+"-internal"]||(d[e+"-internal"]=[s.prototype[e]],d[e]=function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];t[e+"-internal"].map(function(e){return e.apply(t,n)})}),void d[e+"-internal"].push(n.calls[e])):0},l=void 0;t:for(var c in n.calls)switch(l=u(c)){case 0:continue t}if(n.render)for(var h in n.render)this._modulesRender[h]=n.render;if(n.properties)for(var p in n.properties)this.properties[p]||(this.properties[p]=n.properties[p])}},s.prototype._loadEvents=function(){var e=this;return{hide:function(t){if(e.display!==!1){var n=t.target;a(n.parentNode,e._container)||(e.display=!1)}},inputChange:function(n){if(n.target.value){var a=t(n.target.value,e._data.format,!0);e.isValid(a)===!0&&(e._data.model=a),e._data.empty=!1}else e._data.empty=!0;e.redraw(["input","container"]),e.onChange()},inputBlur:function(t){if(e.display!==!1){var n=t.relatedTarget||t.target;a(n.parentNode,e._container)||(e.display=!1)}},inputFocus:function(t){e.display=!0,t.target&&t.target.select&&t.target.select()},yearChange:function(t){e._data.empty=!1,e._data.model.year(t.target.options[t.target.selectedIndex].value),e.isValid(e._data.model),e.redraw(["input","days"]),e.onChange()},monthChange:function(t){e._data.empty=!1,e._data.model.month(t.target.options[t.target.selectedIndex].value),e.isValid(e._data.model),e.redraw(["input","days"]),e.onChange()},dayClick:function(t){t.preventDefault(),t.stopPropagation(),e._data.model.date(t.target.value),e._data.empty=!1,e._data.hideOnDayClick&&(e.display=!1),e.isValid(e._data.model),e.redraw(["input","days"]),e.onChange()},previousMonthDayClick:function(t){e._data.siblingMonthDayClick&&(t.preventDefault(),t.stopPropagation(),e._data.model.date(t.target.value),e._data.model.subtract(1,"month"),e._data.empty=!1,e._data.hideOnDayClick&&(e.display=!1),e.isValid(e._data.model),e.redraw(["input","container"]),e.onChange())},nextMonthDayClick:function(t){e._data.siblingMonthDayClick&&(t.preventDefault(),t.stopPropagation(),e._data.model.date(t.target.value),e._data.model.add(1,"month"),e._data.empty=!1,e._data.hideOnDayClick&&(e.display=!1),e.isValid(e._data.model),e.redraw(["input","container"]),e.onChange())},dayKeyDown:function(){},keyDown:function(t){if(e._data.hideOnEnter){var n=t.which||t.keyCode;13!==n&&27!==n||(document.getElementById(e.inputId).blur(),e.display=!1)}}}},s.prototype.isValid=function(e){if(!(e instanceof t&&e.isValid()))return this._data.valid=!1,!1;var n=this.time?"minute":"day";return e.isBefore(this._data.min,n)||e.isAfter(this._data.max,n)?(this._data.valid=!1,!0):(this._data.valid=!0,!0)},s.prototype.renderInput=function(t,e,n){return this.h("input",{id:e.inputId,value:e.empty?"":e.model.format(e.format),type:"text",min:e.min.format(e.format),max:e.max.format(e.format),format:e.format,onchange:t.inputChange,onfocus:t.inputFocus,name:e.inputName,"aria-invalid":!e.valid,"aria-haspopup":!0,class:e.valid?"":"dpicker-invalid"})},s.prototype.renderContainer=function(t,e,n){return this.h("div",{class:"dpicker"},n)},s.prototype.render=function(t,e,n){return this.h("div",{"aria-hidden":!e.display,class:"dpicker-container "+(e.display?"dpicker-visible":"dpicker-invisible")},n)},s.prototype.renderYears=function(t,e,n){for(var a=e.model.year(),i=e.max.year()+1,r=e.min.year(),o=[];--i>=r;)o.push(this.h("option",{value:i,selected:i===a,key:i},""+i));return this.h("select",{onchange:t.yearChange,name:"dpicker-year","aria-label":"Year"},o)},s.prototype.renderMonths=function(t,e,n){var a=this,i=e.model.month(),r=e.model.year(),o=e.months,d=e.months.map(function(t,e){return e});if(e.max.year()===r){var s=e.max.month();d=d.filter(function(t){return t<=s})}if(e.min.year()===r){var u=e.min.month();d=d.filter(function(t){return t>=u})}return this.h("select",{onchange:t.monthChange,name:"dpicker-month","aria-label":"Month"},d.map(function(t,e){return a.h("option",{value:t,selected:t===i,key:t},o[t])}))},s.prototype.renderDays=function(n,a,i){var r,o,d,s,u=this,l=a.model.daysInMonth(),c=a.model.clone().subtract(1,"months").daysInMonth(),h=t.localeData().firstDayOfWeek(),p=+a.model.clone().date(1).format("e")-1,f=a.model.date(),m=a.model.month(),v=new Array(7);a.days.map(function(t,e){v[e<h?6-e:e-h]=t}),a.model.isSame(a.min,"month")&&(r=a.min.date(),d=a.min.month()),a.model.isSame(a.max,"month")&&(o=a.max.date(),s=a.max.month());var y,_,g=new Array(Math.ceil(.1+(p+l)/7)).fill(0),b=!1,k=!1,C=!0;return this.h("table",[this.h("tr",v.map(function(t){return u.h("th",t)})),g.map(function(t,i){return u.h("tr",{key:i},new Array(7).fill(0).map(function(t,h){return _=C,h<=p&&0===i?(y=c-(p-h),_=!1,b=!0):h===p+1&&0===i?(b=!1,y=1,_=!0):(y===l&&(y=0,_=!1,C=!1,k=!0),y++),_===!1&&a.siblingMonthDayClick===!0&&(_=b?!d||m-d<0:!s||m-s>0),_===!0&&(_="undefined"!=typeof r?y>=r:_,_="undefined"!=typeof o?y<=o:_),u.h("td",{class:_?"dpicker-active":"dpicker-inactive"},[u.h(""+(_?"button":"span"),{value:y,"aria-label":!!_&&"Day "+y,"aria-disabled":!_,onclick:_?b||k?b?n.previousMonthDayClick:n.nextMonthDayClick:n.dayClick:e,type:_?"button":null,onkeydown:_?n.dayKeyDown||e:e,class:f===y?"dpicker-active":""},y)])}))})])},s.prototype._modelSetter=function(t){this._data.empty=!t,this.isValid(t)===!0&&(this._data.model=t),this.redraw()},Object.defineProperties(s.prototype,{container:{get:function(){return this._container}},inputId:{get:function(){return this._data.inputId}},input:{get:function(){return this._data.empty?"":this._data.model.format(this._data.format)}},onChange:{set:function(t){var e=this;this._onChange=function(){return!!t&&t(e._data)}},get:function(){return this._onChange}},valid:{get:function(){return this._data.valid}},model:{set:function(t){this._modelSetter(t)},get:function(){return this._data.model}}}),s.h=s.prototype.h=function(t,e,n){var a=document.createElement(t),i=document.createDocumentFragment();"[object Object]"!==e.toString()&&(n=e,e={}),"undefined"==typeof n?n=[]:Array.isArray(n)||(n=[n]);for(var o in e)e[o]&&("on"===o.substr(0,2)?a[o]=e[o]:"class"===o?a.className=e[o]:e[o]===!0?a[o]=o:r(a,o,e[o]));for(var d=0;d<n.length;d++){if("string"==typeof n[d]||"number"==typeof n[d]){a.innerText=n[d];break}Array.isArray(n[d])?n[d].map(function(t){return i.appendChild(t)}):i.appendChild(n[d])}return a.appendChild(i),a},s.modules={},s});