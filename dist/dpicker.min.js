!function(t,e){"function"==typeof define&&define.amd?define("DPicker",["moment","maquette"],e):"object"==typeof module&&module.exports?module.exports=e(require("moment"),require("maquette")):t.DPicker=e(t.moment,t.maquette)}(this,function(t,e){"use strict";function n(){}function a(t){return function(e,n,a){return function(){return t(e,n,a)}}}function i(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(t){return(t^16*Math.random()>>t/4).toString(16)})}function r(t,e){for(;t&&t!==document;){if(t.getAttribute("id")===e)return!0;t=t.parentNode}return!1}function o(n){var a=void 0!==arguments[1]?arguments[1]:{};if(!(this instanceof o))return new o(n,a);if(this._container=i(),o.hasOwnProperty("properties")||(o.prototype.properties={format:{"default":"DD/MM/YYYY",attribute:"format",getset:!0},model:{"default":t(),moment:!0,attribute:"value"},display:{"default":!1,getset:!0},hideOnDayClick:{"default":!0},hideOnEnter:{"default":!0},min:{"default":t("1986-01-01"),moment:!0,attribute:"min",getset:!0},max:{"default":t().add(1,"year").month(11),moment:!0,attribute:"max",getset:!0},months:{"default":t.months(),getset:!0},days:{"default":t.weekdaysShort(),getset:!0},inputName:{"default":"dpicker-input",attribute:"name"},inputId:{"default":i(),attribute:"id"},empty:{"default":!1},valid:{"default":!0},order:{"default":["months","years","time","days"]}}),this.onChange=a.onChange,this._data={},this._loadModules(),this._initData(a),document.addEventListener("click",this._events.hide),"INPUT"===n.tagName){if(!n.parentNode)throw new ReferenceError("Can not init DPicker on an input without parent node");this._parseInputAttributes([].slice.call(n.attributes));var r=n.parentNode;n.parentNode.removeChild(n),n=r,n.classList.add("dpicker")}return this._initialize(),this._projector=e.createProjector(),this._projector.append(n,this.renderContainer(this._events,this._data,[this.renderInput(this._events,this._data),this.render(this._events,this._data,this.getChildrenRender())])),n.setAttribute("id",this._container),n.addEventListener("keydown",this._events.keyDown),n.querySelector("input").addEventListener("blur",this._events.inputBlur),this}var d=e.h;return o.h=d,o.injector=a,o.prototype._initialize=function(){this.isValid(this._data.model)},o.prototype.getChildrenRender=function(){var t={years:this.renderYears(this._events,this._data),months:this.renderMonths(this._events,this._data)};for(var e in this._modulesRender)for(var n in this._modulesRender[e])t[n]=this._modulesRender[e][n](this._events,this._data);return t.days=this.renderDays(this._events,this._data),this._data.order.map(function(e){return t[e]})},o.prototype._initData=function(t){var e,n=this,a=function(e){var a=n.properties[e];return!a.getset||e in o.prototype||Object.defineProperty(o.prototype,e,{get:function(){return this._data[e]},set:function(t){this._data[e]=t,this._projector.scheduleRender()}}),n._data[e]=a["default"],void 0===t[e]?0:"model"!==e||t[e]?void(n._data[e]=t[e]):(n._data.empty=!0,1)};t:for(var i in this.properties)switch(e=a(i)){case 0:continue t;case 1:continue t}},o.prototype._parseInputAttributes=function(e){var n,a=this,i=function(n){var i=a.properties[n];if(void 0===i.attribute)return 0;if("function"==typeof i.attribute)return a._data[n]=i.attribute(e),1;var r=e.find(function(t){return t.name===i.attribute});if(!r)return 2;var o=r.value;return o?i.moment===!0&&(o=t(r.value,a._data.format,!0),o.isValid()===!1)?5:void(a._data[n]=o):"model"===n?(a._data.empty=!0,3):4};t:for(var r in this.properties)switch(n=i(r)){case 0:continue t;case 1:continue t;case 2:continue t;case 3:continue t;case 4:continue t;case 5:continue t}},o.prototype._loadModules=function(){var t=this;this._events=this._loadEvents(),this._modulesRender={};for(var e in o.modules){var n=o.modules[e],a=this,i=function(e){return a._events[e]?(a._events[e+"-internal"]||(a._events[e+"-internal"]=[a._events[e]],a._events[e]=function(n){t._events[e+"-internal"].map(function(e){return e.bind(t)(n)})}),void a._events[e+"-internal"].push(n.events[e])):(a._events[e]=n.events[e].bind(a),0)},r=void 0;t:for(var d in n.events)switch(r=i(d)){case 0:continue t}var s=this,u=function(e){return o.prototype.hasOwnProperty(e)&&"function"==typeof n.calls[e]?(s[e+"-internal"]||(s[e+"-internal"]=[o.prototype[e]],s[e]=function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];t[e+"-internal"].map(function(e){return e.apply(t,n)})}),void s[e+"-internal"].push(n.calls[e])):0},c=void 0;t:for(var l in n.calls)switch(c=u(l)){case 0:continue t}if(n.render)for(var p in n.render)this._modulesRender[p]=n.render;if(n.properties)for(var h in n.properties)this.properties[h]||(this.properties[h]=n.properties[h])}},o.prototype._loadEvents=function(){var e=this;return{hide:function(t){if(e._data.display!==!1){var n=t.target;r(n.parentNode,e._container)||(e._data.display=!1,e._projector.scheduleRender())}},inputChange:function(n){if(n.target.value){var a=t(n.target.value,e._data.format,!0);e._data.model=e.isValid(a),e._data.empty=!1}else e._data.empty=!0;e.onChange()},inputBlur:function(t){if(e._data.display!==!1){var n=t.relatedTarget||t.target;r(n.parentNode,e._container)||(e._data.display=!1,e._projector.scheduleRender())}},inputFocus:function(t){e._data.display=!0,t.target&&t.target.select&&t.target.select()},yearChange:function(t){e._data.empty=!1,e._data.model.year(t.target.options[t.target.selectedIndex].value),e.onChange()},monthChange:function(t){e._data.empty=!1,e._data.model.month(t.target.options[t.target.selectedIndex].value),e.onChange()},dayClick:function(t){t.preventDefault(),e._data.model.date(t.target.value),e._data.empty=!1,e.onChange(),e._data.hideOnDayClick&&(e._data.display=!1)},dayKeyDown:function(){},keyDown:function(t){if(e._data.hideOnEnter){var n=t.which||t.keyCode;13!==n&&27!==n||(document.getElementById(e.inputId).blur(),e._data.display=!1)}}}},o.prototype.isValid=function(e){if(!(e instanceof t))throw new TypeError("isValid(Moment model), model is not a moment instance");return e.isValid()?e<this._data.min?(this._data.valid=!1,this._data.min.clone()):e>this._data.max?(this._data.valid=!1,this._data.max.clone()):(this._data.valid=!0,e):(this._data.valid=!1,this._data.model)},o.prototype.renderInput=a(function(t,e,n){return d("input#"+e.inputId,{value:e.empty?"":e.model.format(e.format),type:"text",min:e.min.format(e.format),max:e.max.format(e.format),format:e.format,onchange:t.inputChange,onfocus:t.inputFocus,name:e.inputName,"aria-invalid":e.valid,"aria-haspopup":!0})}),o.prototype.renderContainer=a(function(t,e,n){return d("div.dpicker",n.map(function(t){return t()}))}),o.prototype.render=a(function(t,e,n){return d("div.dpicker-container",{classes:{"dpicker-visible":e.display,"aria-hidden":e.display,"dpicker-invisible":!e.display}},n.map(function(t){return t()}))}),o.prototype.renderYears=a(function(t,e,n){for(var a=e.model.year(),i=e.max.year()+1,r=e.min.year(),o=[];--i>=r;)o.push(d("option",{value:i,selected:i===a,key:i},""+i));return d("select",{onchange:t.yearChange,name:"dpicker-year","aria-label":"Year"},o)}),o.prototype.renderMonths=a(function(t,e,n){var a=e.model.month(),i=e.model.year(),r=e.months,o=e.months.map(function(t,e){return e});if(e.max.year()===i){var s=e.max.month();o=o.filter(function(t){return t<=s})}if(e.min.year()===i){var u=e.min.month();o=o.filter(function(t){return t>=u})}return d("select",{onchange:t.monthChange,name:"dpicker-month","aria-label":"Month"},o.map(function(t,e){return d("option",{value:t,selected:t===a,key:t},r[t])}))}),o.prototype.renderDays=a(function(t,e,a){var i,r,o=e.model.daysInMonth(),s=e.model.clone().subtract(1,"months").daysInMonth(),u=+e.model.clone().date(1).format("e")-1,c=e.model.date();e.model.isSame(e.min,"month")&&(i=e.min.date()),e.model.isSame(e.max,"month")&&(r=e.max.date());var l,p,h=new Array(Math.ceil(.1+(u+o)/7)).fill(0),m=!0;return d("table",[d("tr",e.days.map(function(t){return d("th",t)})),h.map(function(e,a){return d("tr",{key:a},new Array(7).fill(0).map(function(e,h){return p=m,h<=u&&0===a?(l=s-(u-h),p=!1):h===u+1&&0===a?(l=1,p=!0):(l===o&&(l=0,p=!1,m=!1),l++),p===!0&&(p="undefined"!=typeof i?l>=i:p,p="undefined"!=typeof r?l<=r:p),d("td",{classes:{"dpicker-active":p,"dpicker-inactive":!p}},[d(p?"button":"span",{value:l,"aria-label":!!p&&"Day "+l,"aria-disabled":!p,onclick:p?t.dayClick:n,type:p?"button":null,onkeydown:p?t.dayKeyDown||n:n,classes:{"dpicker-active":c===l}},l)])}))})])}),o.prototype._modelSetter=function(e){this._data.empty=!e,e instanceof t&&(this._data.model=this.isValid(e)),this._projector.scheduleRender()},Object.defineProperties(o.prototype,{container:{get:function(){return this._container}},inputId:{get:function(){return this._data.inputId}},input:{get:function(){return this._data.empty?"":this._data.model.format(this._data.format)}},onChange:{set:function(t){var e=this;this._onChange=function(){return!!t&&t(e._data)}},get:function(){return this._onChange}},valid:{get:function(){return this._data.valid}},model:{set:function(t){this._modelSetter(t)},get:function(){return this._data.model}}}),o.modules={},o});