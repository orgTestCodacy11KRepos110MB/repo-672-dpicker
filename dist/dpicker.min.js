!function(t,e){"function"==typeof define&&define.amd?define("DPicker",["moment"],e):"object"==typeof module&&module.exports?module.exports=e(require("moment")):t.DPicker=e(t.moment)}(this,function(t){"use strict";function e(){}function n(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(t){return(t^16*Math.random()>>t/4).toString(16)})}function i(t,e){for(;t&&t!==document;){if(t.getAttribute("id")===e)return!0;t=t.parentNode}return!1}function a(e){var i=void 0!==arguments[1]?arguments[1]:{},r=this;if(!(this instanceof a))return new a(e,i);if(this._container=n(),a.hasOwnProperty("properties")||(a.prototype.properties={format:{default:"DD/MM/YYYY",attribute:"format",getset:!0},model:{default:t(),moment:!0,attribute:"value"},display:{default:!1,getset:!0},hideOnDayClick:{default:!0},hideOnEnter:{default:!0},min:{default:t("1986-01-01"),moment:!0,attribute:"min",getset:!0},max:{default:t().add(1,"year").month(11),moment:!0,attribute:"max",getset:!0},months:{default:t.months(),getset:!0},days:{default:t.weekdaysShort(),getset:!0},inputName:{default:"dpicker-input",attribute:"name"},inputId:{default:n(),attribute:"id"},empty:{default:!1},valid:{default:!0},order:{default:["months","years","time","days"]}}),this.onChange=i.onChange,this._data={},this._loadModules(),this._initData(i),document.addEventListener("click",this._events.hide),"INPUT"===e.tagName){if(!e.parentNode)throw new ReferenceError("Can not init DPicker on an input without parent node");this._parseInputAttributes([].slice.call(e.attributes));var o=e.parentNode;e.parentNode.removeChild(e),e=o,e.classList.add("dpicker")}this._initialize(),this.mount(e,this.renderContainer(this._events,this._data,[this.renderInput(this._events,this._data),this.render(this._events,this._data,this.getRenderChild())])),e.setAttribute("id",this._container),e.addEventListener("keydown",this._events.keyDown);var s=e.querySelector("input");return s.addEventListener("blur",this._events.inputBlur),document.addEventListener("touchend",function(t){r._events.inputBlur(t)}),this.rootElement=e,this}return a.prototype.toggle=function(){var t=this.rootElement.querySelector(".dpicker-container");this.display===!0?(t.classList.remove("dpicker-invisible"),t.classList.add("dpicker-visible")):(t.classList.add("dpicker-invisible"),t.classList.remove("dpicker-visible"))},a.prototype._initialize=function(){this.isValid(this._data.model)},a.prototype.mount=function(t,e){t.appendChild(e)},a.prototype.replace=function(t,e){var n=this.rootElement.querySelector(t);n.parentNode.replaceChild(e,n)},a.prototype.merge=function(t,e){for(var n=this.rootElement.querySelector(t),i=0;i<e.attributes.length;i++){var a=e.attributes[i];n.getAttribute(a.name)!==a.value&&n.setAttribute(a.name,a.value)}for(var r=0;r<n.attributes.length;r++){var o=n.attributes[r];e.hasAttribute(o.name)||n.removeAttribute(o.name)}e.value!==n.value&&(n.value=e.value)},a.prototype.redraw=function(t){t||(t=["input","container"]);for(var e=0;e<t.length;e++)switch(t[e]){case"input":this.merge("input",this.renderInput(this._events,this._data));break;case"days":this.replace("table",this.renderDays(this._events,this._data));break;case"container":this.replace(".dpicker-container",this.render(this._events,this._data,this.getRenderChild()))}},a.prototype.getRenderChild=function(){var t={years:this.renderYears(this._events,this._data),months:this.renderMonths(this._events,this._data)};for(var e in this._modulesRender)for(var n in this._modulesRender[e])t[n]=this._modulesRender[e][n](this._events,this._data);return t.days=this.renderDays(this._events,this._data),this._data.order.filter(function(e){return t[e]}).map(function(e){return t[e]})},a.prototype._initData=function(t){var e,n=this,i=function(e){var i=n.properties[e];return!i.getset||e in a.prototype||Object.defineProperty(a.prototype,e,{get:function(){return this._data[e]},set:function(t){this._data[e]=t,"display"===e?this.toggle():this.redraw()}}),n._data[e]=i.default,void 0===t[e]?0:"model"!==e||t[e]?void(n._data[e]=t[e]):(n._data.empty=!0,1)};t:for(var r in this.properties)switch(e=i(r)){case 0:continue t;case 1:continue t}},a.prototype._parseInputAttributes=function(e){var n,i=this,a=function(n){var a=i.properties[n];if(void 0===a.attribute)return 0;if("function"==typeof a.attribute)return i._data[n]=a.attribute(e),1;var r=e.find(function(t){return t.name===a.attribute});if(!r)return 2;var o=r.value;return o?a.moment===!0&&(o=t(r.value,i._data.format,!0),o.isValid()===!1)?5:void(i._data[n]=o):"model"===n?(i._data.empty=!0,3):4};t:for(var r in this.properties)switch(n=a(r)){case 0:continue t;case 1:continue t;case 2:continue t;case 3:continue t;case 4:continue t;case 5:continue t}},a.prototype._loadModules=function(){var t=this;this._events=this._loadEvents(),this._modulesRender={};for(var e in a.modules){var n=a.modules[e],i=this,r=function(e){return i._events[e]?(i._events[e+"-internal"]||(i._events[e+"-internal"]=[i._events[e]],i._events[e]=function(n){t._events[e+"-internal"].map(function(e){return e.bind(t)(n)})}),void i._events[e+"-internal"].unshift(n.events[e])):(i._events[e]=n.events[e].bind(i),0)},o=void 0;t:for(var s in n.events)switch(o=r(s)){case 0:continue t}var d=this,u=function(e){return a.prototype.hasOwnProperty(e)&&"function"==typeof n.calls[e]?(d[e+"-internal"]||(d[e+"-internal"]=[a.prototype[e]],d[e]=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];t[e+"-internal"].map(function(e){return e.apply(t,n)})}),void d[e+"-internal"].push(n.calls[e])):0},l=void 0;t:for(var p in n.calls)switch(l=u(p)){case 0:continue t}if(n.render)for(var c in n.render)this._modulesRender[c]=n.render;if(n.properties)for(var h in n.properties)this.properties[h]||(this.properties[h]=n.properties[h])}},a.prototype._loadEvents=function(){var e=this;return{hide:function(t){if(e.display!==!1){var n=t.target;i(n.parentNode,e._container)||(e.display=!1)}},inputChange:function(n){if(n.target.value){var i=t(n.target.value,e._data.format,!0);e.isValid(i)===!0&&(e._data.model=i),e._data.empty=!1}else e._data.empty=!0;e.redraw(["input","container"]),e.onChange()},inputBlur:function(t){if(e.display!==!1){var n=t.relatedTarget||t.target;i(n.parentNode,e._container)||(e.display=!1)}},inputFocus:function(t){e.display=!0,t.target&&t.target.select&&t.target.select()},yearChange:function(t){e._data.empty=!1,e._data.model.year(t.target.options[t.target.selectedIndex].value),e.redraw(["input","days"]),e.onChange()},monthChange:function(t){e._data.empty=!1,e._data.model.month(t.target.options[t.target.selectedIndex].value),e.redraw(["input","days"]),e.onChange()},dayClick:function(t){t.preventDefault(),e._data.model.date(t.target.value),e._data.empty=!1,e._data.hideOnDayClick&&(e.display=!1),e.redraw(["input"]),e.onChange()},dayKeyDown:function(){},keyDown:function(t){if(e._data.hideOnEnter){var n=t.which||t.keyCode;13!==n&&27!==n||(document.getElementById(e.inputId).blur(),e.display=!1)}}}},a.prototype.isValid=function(e){return e instanceof t&&e.isValid()?e<this._data.min||e>this._data.max?(this._data.valid=!1,!0):(this._data.valid=!0,!0):(this._data.valid=!1,!1)},a.prototype.renderInput=function(t,e,n){return this.h("input",{id:e.inputId,value:e.empty?"":e.model.format(e.format),type:"text",min:e.min.format(e.format),max:e.max.format(e.format),format:e.format,onchange:t.inputChange,onfocus:t.inputFocus,name:e.inputName,"aria-invalid":!e.valid,"aria-haspopup":!0,class:e.valid?"":"dpicker-invalid"})},a.prototype.renderContainer=function(t,e,n){return this.h("div",{class:"dpicker"},n)},a.prototype.render=function(t,e,n){return this.h("div",{"aria-hidden":!e.display,class:"dpicker-container "+(e.display?"dpicker-visible":"dpicker-invisible")},n)},a.prototype.renderYears=function(t,e,n){for(var i=e.model.year(),a=e.max.year()+1,r=e.min.year(),o=[];--a>=r;)o.push(this.h("option",{value:a,selected:a===i,key:a},""+a));return this.h("select",{onchange:t.yearChange,name:"dpicker-year","aria-label":"Year"},o)},a.prototype.renderMonths=function(t,e,n){var i=this,a=e.model.month(),r=e.model.year(),o=e.months,s=e.months.map(function(t,e){return e});if(e.max.year()===r){var d=e.max.month();s=s.filter(function(t){return t<=d})}if(e.min.year()===r){var u=e.min.month();s=s.filter(function(t){return t>=u})}return this.h("select",{onchange:t.monthChange,name:"dpicker-month","aria-label":"Month"},s.map(function(t,e){return i.h("option",{value:t,selected:t===a,key:t},o[t])}))},a.prototype.renderDays=function(n,i,a){var r,o,s=this,d=i.model.daysInMonth(),u=i.model.clone().subtract(1,"months").daysInMonth(),l=t.localeData().firstDayOfWeek(),p=+i.model.clone().date(1).format("e")-1,c=i.model.date(),h=new Array(7);i.days.map(function(t,e){h[e<l?7-e:e-l]=t}),i.model.isSame(i.min,"month")&&(r=i.min.date()),i.model.isSame(i.max,"month")&&(o=i.max.date());var f,m,v=new Array(Math.ceil(.1+(p+d)/7)).fill(0),y=!0;return this.h("table",[this.h("tr",h.map(function(t){return s.h("th",t)})),v.map(function(t,i){return s.h("tr",{key:i},new Array(7).fill(0).map(function(t,a){return m=y,a<=p&&0===i?(f=u-(p-a),m=!1):a===p+1&&0===i?(f=1,m=!0):(f===d&&(f=0,m=!1,y=!1),f++),m===!0&&(m="undefined"!=typeof r?f>=r:m,m="undefined"!=typeof o?f<=o:m),s.h("td",{class:m?"dpicker-active":"dpicker-inactive"},[s.h(""+(m?"button":"span"),{value:f,"aria-label":!!m&&"Day "+f,"aria-disabled":!m,onclick:m?n.dayClick:e,type:m?"button":null,onkeydown:m?n.dayKeyDown||e:e,class:c===f?"dpicker-active":""},f)])}))})])},a.prototype._modelSetter=function(t){this._data.empty=!t,this.isValid(t)===!0&&(this._data.model=t),this.redraw()},Object.defineProperties(a.prototype,{container:{get:function(){return this._container}},inputId:{get:function(){return this._data.inputId}},input:{get:function(){return this._data.empty?"":this._data.model.format(this._data.format)}},onChange:{set:function(t){var e=this;this._onChange=function(){return!!t&&t(e._data)}},get:function(){return this._onChange}},valid:{get:function(){return this._data.valid}},model:{set:function(t){this._modelSetter(t)},get:function(){return this._data.model}}}),a.h=a.prototype.h=function(t,e,n){var i=document.createElement(t),a=document.createDocumentFragment();"[object Object]"!==e.toString()&&(n=e,e={}),"undefined"==typeof n?n=[]:Array.isArray(n)||(n=[n]);for(var r in e)e[r]&&("on"===r.substr(0,2)?i[r]=e[r]:e[r]===!0?i.setAttribute(r,r):i.setAttribute(r,e[r]));for(var o=0;o<n.length;o++){if("string"==typeof n[o]||"number"==typeof n[o]){i.innerText=n[o];break}Array.isArray(n[o])?n[o].map(function(t){return a.appendChild(t)}):a.appendChild(n[o])}return i.appendChild(a),i},a.modules={},a});