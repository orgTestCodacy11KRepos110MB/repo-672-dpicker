!function(t,e){"function"==typeof define&&define.amd?define("DPicker",["moment"],e):"object"==typeof module&&module.exports?module.exports=e(require("moment")):t.DPicker=e(t.moment)}(this,function(t){"use strict";function e(){}function n(t){return function(e,n,a){return function(){return t(e,n,a)}}}function a(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(t){return(t^16*Math.random()>>t/4).toString(16)})}function i(t,e){for(;t&&t!==document;){if(t.getAttribute("id")===e)return!0;t=t.parentNode}return!1}function r(e){var n=void 0!==arguments[1]?arguments[1]:{},i=this;if(!(this instanceof r))return new r(e,n);if("undefined"==typeof maquette&&"function"==typeof require&&(maquette=require("maquette")),n.h&&n.mount&&n.redraw)r.h=n.h,this.mount=n.mount,this.redraw=n.redraw;else{if("undefined"==typeof maquette)throw new ReferenceError("No hyperscript library registered!");r.h=maquette.h,this._projector=maquette.createProjector()}if(this._container=a(),r.hasOwnProperty("properties")||(r.prototype.properties={format:{"default":"DD/MM/YYYY",attribute:"format",getset:!0},model:{"default":t(),moment:!0,attribute:"value"},display:{"default":!1,getset:!0},hideOnDayClick:{"default":!0},hideOnEnter:{"default":!0},min:{"default":t("1986-01-01"),moment:!0,attribute:"min",getset:!0},max:{"default":t().add(1,"year").month(11),moment:!0,attribute:"max",getset:!0},months:{"default":t.months(),getset:!0},days:{"default":t.weekdaysShort(),getset:!0},inputName:{"default":"dpicker-input",attribute:"name"},inputId:{"default":a(),attribute:"id"},empty:{"default":!1},valid:{"default":!0},order:{"default":["months","years","time","days"]}}),this.onChange=n.onChange,this._data={},this._loadModules(),this._initData(n),document.addEventListener("click",this._events.hide),"INPUT"===e.tagName){if(!e.parentNode)throw new ReferenceError("Can not init DPicker on an input without parent node");this._parseInputAttributes([].slice.call(e.attributes));var o=e.parentNode;e.parentNode.removeChild(e),e=o,e.classList.add("dpicker")}this._initialize(),this.mount(e,this.renderContainer(this._events,this._data,[this.renderInput(this._events,this._data),this.render(this._events,this._data,this.getRenderChild())])),e.setAttribute("id",this._container),e.addEventListener("keydown",this._events.keyDown);var d=e.querySelector("input");return d.addEventListener("blur",this._events.inputBlur),document.addEventListener("touchend",function(t){i._events.inputBlur(t)}),this}return r.injector=n,r.prototype._initialize=function(){this.isValid(this._data.model)},r.prototype.mount=function(t,e){this._projector.append(t,e)},r.prototype.redraw=function(){this._projector.scheduleRender()},r.prototype.getRenderChild=function(){var t={years:this.renderYears(this._events,this._data),months:this.renderMonths(this._events,this._data)};for(var e in this._modulesRender)for(var n in this._modulesRender[e])t[n]=this._modulesRender[e][n](this._events,this._data);return t.days=this.renderDays(this._events,this._data),this._data.order.filter(function(e){return t[e]}).map(function(e){return t[e]})},r.prototype._initData=function(t){var e,n=this,a=function(e){var a=n.properties[e];return!a.getset||e in r.prototype||Object.defineProperty(r.prototype,e,{get:function(){return this._data[e]},set:function(t){this._data[e]=t,this.redraw()}}),n._data[e]=a["default"],void 0===t[e]?0:"model"!==e||t[e]?void(n._data[e]=t[e]):(n._data.empty=!0,1)};t:for(var i in this.properties)switch(e=a(i)){case 0:continue t;case 1:continue t}},r.prototype._parseInputAttributes=function(e){var n,a=this,i=function(n){var i=a.properties[n];if(void 0===i.attribute)return 0;if("function"==typeof i.attribute)return a._data[n]=i.attribute(e),1;var r=e.find(function(t){return t.name===i.attribute});if(!r)return 2;var o=r.value;return o?i.moment===!0&&(o=t(r.value,a._data.format,!0),o.isValid()===!1)?5:void(a._data[n]=o):"model"===n?(a._data.empty=!0,3):4};t:for(var r in this.properties)switch(n=i(r)){case 0:continue t;case 1:continue t;case 2:continue t;case 3:continue t;case 4:continue t;case 5:continue t}},r.prototype._loadModules=function(){var t=this;this._events=this._loadEvents(),this._modulesRender={};for(var e in r.modules){var n=r.modules[e],a=this,i=function(e){return a._events[e]?(a._events[e+"-internal"]||(a._events[e+"-internal"]=[a._events[e]],a._events[e]=function(n){t._events[e+"-internal"].map(function(e){return e.bind(t)(n)})}),void a._events[e+"-internal"].push(n.events[e])):(a._events[e]=n.events[e].bind(a),0)},o=void 0;t:for(var d in n.events)switch(o=i(d)){case 0:continue t}var s=this,u=function(e){return r.prototype.hasOwnProperty(e)&&"function"==typeof n.calls[e]?(s[e+"-internal"]||(s[e+"-internal"]=[r.prototype[e]],s[e]=function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];t[e+"-internal"].map(function(e){return e.apply(t,n)})}),void s[e+"-internal"].push(n.calls[e])):0},c=void 0;t:for(var p in n.calls)switch(c=u(p)){case 0:continue t}if(n.render)for(var h in n.render)this._modulesRender[h]=n.render;if(n.properties)for(var l in n.properties)this.properties[l]||(this.properties[l]=n.properties[l])}},r.prototype._loadEvents=function(){var e=this;return{hide:function(t){if(e._data.display!==!1){var n=t.target;i(n.parentNode,e._container)||(e._data.display=!1,e.redraw())}},inputChange:function(n){if(n.target.value){var a=t(n.target.value,e._data.format,!0);e._data.model=e.isValid(a),e._data.empty=!1}else e._data.empty=!0;e.onChange()},inputBlur:function(t){if(e._data.display!==!1){var n=t.relatedTarget||t.target;i(n.parentNode,e._container)||(e._data.display=!1,e.redraw())}},inputFocus:function(t){e._data.display=!0,t.target&&t.target.select&&t.target.select()},yearChange:function(t){e._data.empty=!1,e._data.model.year(t.target.options[t.target.selectedIndex].value),e.onChange()},monthChange:function(t){e._data.empty=!1,e._data.model.month(t.target.options[t.target.selectedIndex].value),e.onChange()},dayClick:function(t){t.preventDefault(),e._data.model.date(t.target.value),e._data.empty=!1,e.onChange(),e._data.hideOnDayClick&&(e._data.display=!1)},dayKeyDown:function(){},keyDown:function(t){if(e._data.hideOnEnter){var n=t.which||t.keyCode;13!==n&&27!==n||(document.getElementById(e.inputId).blur(),e._data.display=!1)}}}},r.prototype.isValid=function(e){if(!(e instanceof t))throw new TypeError("isValid(Moment model), model is not a moment instance");return e.isValid()?e<this._data.min?(this._data.valid=!1,this._data.min.clone()):e>this._data.max?(this._data.valid=!1,this._data.max.clone()):(this._data.valid=!0,e):(this._data.valid=!1,this._data.model)},r.prototype.renderInput=n(function(t,e,n){return r.h("input#"+e.inputId,{value:e.empty?"":e.model.format(e.format),type:"text",min:e.min.format(e.format),max:e.max.format(e.format),format:e.format,onchange:t.inputChange,onfocus:t.inputFocus,name:e.inputName,"aria-invalid":e.valid,"aria-haspopup":!0})}),r.prototype.renderContainer=n(function(t,e,n){return r.h("div.dpicker",n.map(function(t){return t()}))}),r.prototype.render=n(function(t,e,n){return r.h("div.dpicker-container",{classes:{"dpicker-visible":e.display,"aria-hidden":e.display,"dpicker-invisible":!e.display}},n.map(function(t){return t()}))}),r.prototype.renderYears=n(function(t,e,n){for(var a=e.model.year(),i=e.max.year()+1,o=e.min.year(),d=[];--i>=o;)d.push(r.h("option",{value:i,selected:i===a,key:i},""+i));return r.h("select",{onchange:t.yearChange,name:"dpicker-year","aria-label":"Year"},d)}),r.prototype.renderMonths=n(function(t,e,n){var a=e.model.month(),i=e.model.year(),o=e.months,d=e.months.map(function(t,e){return e});if(e.max.year()===i){var s=e.max.month();d=d.filter(function(t){return t<=s})}if(e.min.year()===i){var u=e.min.month();d=d.filter(function(t){return t>=u})}return r.h("select",{onchange:t.monthChange,name:"dpicker-month","aria-label":"Month"},d.map(function(t,e){return r.h("option",{value:t,selected:t===a,key:t},o[t])}))}),r.prototype.renderDays=n(function(n,a,i){var o,d,s=a.model.daysInMonth(),u=a.model.clone().subtract(1,"months").daysInMonth(),c=t.localeData().firstDayOfWeek(),p=+a.model.clone().date(1).format("e")-1,h=a.model.date(),l=new Array(7);a.days.map(function(t,e){l[e<c?7-e:e-c]=t}),a.model.isSame(a.min,"month")&&(o=a.min.date()),a.model.isSame(a.max,"month")&&(d=a.max.date());var f,m,y=new Array(Math.ceil(.1+(p+s)/7)).fill(0),v=!0;return r.h("table",[r.h("tr",l.map(function(t){return r.h("th",t)})),y.map(function(t,a){return r.h("tr",{key:a},new Array(7).fill(0).map(function(t,i){return m=v,i<=p&&0===a?(f=u-(p-i),m=!1):i===p+1&&0===a?(f=1,m=!0):(f===s&&(f=0,m=!1,v=!1),f++),m===!0&&(m="undefined"!=typeof o?f>=o:m,m="undefined"!=typeof d?f<=d:m),r.h("td",{classes:{"dpicker-active":m,"dpicker-inactive":!m}},[r.h(m?"button":"span",{value:f,"aria-label":!!m&&"Day "+f,"aria-disabled":!m,onclick:m?n.dayClick:e,type:m?"button":null,onkeydown:m?n.dayKeyDown||e:e,classes:{"dpicker-active":h===f}},f)])}))})])}),r.prototype._modelSetter=function(e){this._data.empty=!e,e instanceof t&&(this._data.model=this.isValid(e)),this.redraw()},Object.defineProperties(r.prototype,{container:{get:function(){return this._container}},inputId:{get:function(){return this._data.inputId}},input:{get:function(){return this._data.empty?"":this._data.model.format(this._data.format)}},onChange:{set:function(t){var e=this;this._onChange=function(){return!!t&&t(e._data)}},get:function(){return this._onChange}},valid:{get:function(){return this._data.valid}},model:{set:function(t){this._modelSetter(t)},get:function(){return this._data.model}}}),r.modules={},r});